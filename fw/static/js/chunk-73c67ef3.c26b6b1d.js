(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73c67ef3"],{"0a16":function(e,t,a){"use strict";var s=a("a372"),n=a.n(s);n.a},2664:function(e,t,a){"use strict";var s=a("4855"),n=a.n(s);n.a},"3a37":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"searchInfo"},[a("span",{staticClass:"seachname"},[e._v(" 零件编号: ")]),a("el-input",{staticClass:"inputCls",attrs:{placeholder:"请输入零件编号",clearable:""},model:{value:e.searchKey.code,callback:function(t){e.$set(e.searchKey,"code",t)},expression:"searchKey.code"}}),a("span",{staticClass:"seachname",staticStyle:{"margin-left":"15px"}},[e._v(" 零件名称: ")]),a("el-input",{staticClass:"inputCls",attrs:{placeholder:"请输入零件名称",clearable:""},model:{value:e.searchKey.name,callback:function(t){e.$set(e.searchKey,"name",t)},expression:"searchKey.name"}}),a("el-button",{staticClass:"primaryBtn",staticStyle:{"margin-left":"7px"},attrs:{type:"primary"},on:{click:e.searchBtn}},[a("svg-icon",{attrs:{"icon-class":"search"}}),e._v(" 查询 ")],1),a("el-button",{staticClass:"resetBtn",staticStyle:{"margin-left":"7px"},attrs:{type:"default",icon:"el-icon-refresh-right"},on:{click:e.searchrestBtn}},[e._v(" 重置 ")])],1),a("div",{staticClass:"searchInfo"},[e.hasPermission("processCard/add")?a("el-button",{staticClass:"addBtn",attrs:{type:"default",icon:"el-icon-plus"},on:{click:e.addBtn}},[e._v(" 新增")]):e._e()],1),a("div",{staticClass:"el-tablenew"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.list,"row-class-name":e.tableRowClassName,border:"",height:"calc(100vh - 337px)"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),a("el-table-column",{attrs:{prop:"date",label:"序号",align:"center",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.$index+1)+" ")]}}])}),a("el-table-column",{attrs:{prop:"code",label:"工艺编号",align:"center"}}),a("el-table-column",{attrs:{prop:"partCode",label:"零件编号",align:"center"}}),a("el-table-column",{attrs:{prop:"partName",label:"零件名称",align:"center"}}),a("el-table-column",{attrs:{prop:"updateType",label:"变更类型",align:"center",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(0===t.row.updateType?"临时变更":1===t.row.updateType?"永久变更":"")+" ")]}}])}),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间",align:"center",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.createTime&&t.row.createTime.length>10?t.row.createTime.substring(0,10):t.row.createTime))])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"defaultTextBtn",attrs:{type:"text"},on:{click:function(a){return e.findInfo(t.row)}}},[a("svg-icon",{attrs:{"icon-class":"search"}}),e._v(" 查看 ")],1),0!==t.row.updateType&&0===t.row.auditStatus&&e.hasPermission("processCard/edit")?a("el-button",{staticClass:"addTextBtn",attrs:{type:"text"},on:{click:function(a){return e.editBtn(t.row)}}},[a("svg-icon",{attrs:{"icon-class":"edit"}}),e._v(" 变更 ")],1):e._e()]}}])})],1),a("pagination",{staticClass:"pagePadd",attrs:{total:e.total,page:e.pageIndex,limit:e.pageSize},on:{"update:page":function(t){e.pageIndex=t},"update:limit":function(t){e.pageSize=t},pagination:e.handleCurrentChange}})],1),e.showDialog?a("div",{staticClass:"showDialogsty"},[a("new-card",{attrs:{objstr:e.objstr},on:{DetailCallBack:e.DetailCallBack}})],1):e._e()])},n=[],o=(a("a15b"),a("b0c0"),a("b85c")),r=a("644f"),i=a("333d"),l=a("97a2"),c={name:"ProcessCard",components:{Pagination:i["a"],"new-card":l["a"]},data:function(){return{searchKey:{code:"",name:""},objstr:null,loading:!1,showDialog:!1,total:0,pageIndex:1,pageSize:10,currentId:0,multipleSelection:[],list:[]}},computed:{},mounted:function(){this.fetchDate()},methods:{tableRowClassName:function(e){e.row;var t=e.rowIndex;return t%2===1?"table-row":""},fetchDate:function(){var e=this;this.list=[],this.multipleSelection=[],this.loading=!0;var t={partCode:this.searchKey.code+""?this.searchKey.code:null,partName:this.searchKey.name+""?this.searchKey.name:null,pageNum:this.pageIndex,pageSize:this.pageSize};Object(r["d"])(t).then((function(t){e.loading=!1,0===t.code&&(e.list=t.data.list,e.total=t.data.total)}))},searchBtn:function(){this.fetchDate()},searchrestBtn:function(){this.searchKey={code:"",name:""},this.pageIndex=1,this.pageSize=10,this.fetchDate()},handleSelectionChange:function(e){this.multipleSelection=e},handleCurrentChange:function(){this.fetchDate()},deleteAll:function(){var e=this;if(0===this.multipleSelection.length)return this.$message({message:"请选择需要删除的数据!",type:"warning"}),!1;var t,a=[],s=Object(o["a"])(this.multipleSelection);try{for(s.s();!(t=s.n()).done;){var n=t.value;a.push(n.id)}}catch(i){s.e(i)}finally{s.f()}this.$confirm("确定批量删除吗?","操作提示",{confirmButtonText:"确认删除",cancelButtonText:"取消"}).then((function(){var t={ids:a.join(",")};Object(r["a"])(t).then((function(t){e.loading=!1,0===t.code?(e.$message({message:"删除成功!",type:"success"}),e.list.length===a.length&&e.pageIndex>1&&(e.pageIndex=e.pageIndex-1),e.fetchDate()):1e3===t.code&&e.$message({message:t.msg,type:"error"})}))}))},deleteBtn:function(e){var t=this;this.$confirm("确定删除吗?","操作提示",{confirmButtonText:"确认删除",cancelButtonText:"取消"}).then((function(){var a={ids:e.id};Object(r["a"])(a).then((function(e){t.loading=!1,0===e.code?(t.$message({message:"删除成功!",type:"success"}),1===t.list.length&&t.pageIndex>1&&(t.pageIndex=t.pageIndex-1),t.fetchDate()):1e3===e.code&&t.$message({message:e.msg,type:"error"})}))}))},addBtn:function(){sessionStorage.removeItem("cardFromJson"),this.objstr={type:"add"},this.showDialog=!0},editBtn:function(e){sessionStorage.removeItem("cardFromJson"),this.objstr=e,this.objstr.type="edit",sessionStorage.setItem("cardFromJson",JSON.stringify({productCode:e.partCode,productName:e.partName,craftNo:e.documentNo,deviceNo:e.productId})),this.showDialog=!0},findInfo:function(e){sessionStorage.removeItem("cardFromJson"),this.objstr=e,this.objstr.type="find",sessionStorage.setItem("cardFromJson",JSON.stringify({productCode:e.partCode,productName:e.partName,craftNo:e.documentNo,deviceNo:e.productId})),this.showDialog=!0},DetailCallBack:function(e){this.showDialog=!1,"1"===e.result&&this.fetchDate()}}},d=c,u=(a("2664"),a("2877")),p=Object(u["a"])(d,s,n,!1,null,"79743ea4",null);t["default"]=p.exports},4855:function(e,t,a){},"97a2":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"app-container"},[a("el-page-header",{attrs:{content:"工艺模型"},on:{back:function(t){return e.backClick(null)}}}),a("div",{staticClass:"content1"},[e._m(0),a("div",{staticClass:"contentBody"},[a("el-form",{ref:"forms",attrs:{model:e.forms,rules:e.rules,"label-position":"left","label-width":"100px"}},[a("el-form-item",{attrs:{label:"工艺卡:",prop:"productName"}},[a("el-select",{staticClass:"inputCls",staticStyle:{"max-width":"300px"},attrs:{disabled:"add"!==e.type,placeholder:"工艺卡"},on:{change:function(t){return e.changeCraft()}},model:{value:e.forms.productName,callback:function(t){e.$set(e.forms,"productName",t)},expression:"forms.productName"}},e._l(e.listCard,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1)]),a("div",{staticClass:"content1",staticStyle:{overflow:"auto"}},[e._m(1),a("div",{staticClass:"contentBody",staticStyle:{"min-width":"1600px"}},[1===e.forms.productName||""===e.forms.productName?a("rj1",{attrs:{type:e.type,"is-checked":e.isChecked}}):e._e(),2===e.forms.productName?a("rj2",{attrs:{type:e.type,"is-checked":e.isChecked}}):e._e(),3===e.forms.productName?a("yb",{attrs:{type:e.type,"is-checked":e.isChecked}}):e._e(),4===e.forms.productName?a("gjj",{attrs:{type:e.type,"is-checked":e.isChecked}}):e._e(),5===e.forms.productName?a("ht",{attrs:{type:e.type,"is-checked":e.isChecked}}):e._e(),6===e.forms.productName?a("jjft",{attrs:{type:e.type,"is-checked":e.isChecked}}):e._e(),7===e.forms.productName?a("klsmf",{attrs:{type:e.type,"is-checked":e.isChecked}}):e._e(),8===e.forms.productName?a("dmg",{attrs:{type:e.type,"is-checked":e.isChecked}}):e._e()],1)]),"edit"===e.type?a("div",{staticClass:"content1"},[e._m(2),a("div",{staticClass:"contentBody",staticStyle:{overflow:"auto"}},[a("el-form",{ref:"upforms",attrs:{model:e.upforms,rules:e.rules,"label-position":"left","label-width":"100px"}},[a("el-form-item",{attrs:{label:"变更类型:",prop:"upType"}},[a("el-select",{staticClass:"inputCls",staticStyle:{"max-width":"300px"},attrs:{placeholder:"变更类型"},model:{value:e.upforms.upType,callback:function(t){e.$set(e.upforms,"upType",t)},expression:"upforms.upType"}},e._l(e.upList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"变更原因:",prop:"upReason"}},[a("el-input",{staticStyle:{"max-width":"300px"},attrs:{placeholder:"变更原因",maxlength:"20"},model:{value:e.upforms.upReason,callback:function(t){e.$set(e.upforms,"upReason",t)},expression:"upforms.upReason"}})],1),a("el-form-item",{attrs:{label:"变更描述:",prop:"dis"}},[a("el-input",{staticStyle:{"max-width":"300px"},attrs:{rows:5,resize:"none",type:"textarea",placeholder:"变更描述",maxlength:"50"},model:{value:e.upforms.dis,callback:function(t){e.$set(e.upforms,"dis",t)},expression:"upforms.dis"}})],1)],1)],1)]):e._e(),"find"===e.type?a("div",{staticClass:"content1"},[e._m(3),a("div",{staticClass:"contentBody el-tablenew"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.logsList,"row-class-name":e.tableRowClassName,border:""}},[a("el-table-column",{attrs:{prop:"date",label:"序号",align:"center",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.$index+1)+" ")]}}],null,!1,3056706777)}),a("el-table-column",{attrs:{prop:"updateType",label:"变更类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(0===t.row.updateType?"临时变更":1===t.row.updateType?"永久变更":"")+" ")]}}],null,!1,2797812034)}),a("el-table-column",{attrs:{prop:"reason",label:"变更原因",align:"center","show-overflow-tooltip":"","min-width":"120px"}}),a("el-table-column",{attrs:{prop:"content",label:"变更内容描述",align:"center","show-overflow-tooltip":"","min-width":"120px"}}),a("el-table-column",{attrs:{prop:"user.name",label:"变更人员",align:"center"}}),a("el-table-column",{attrs:{prop:"createTime",label:"变更时间",align:"center",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.createTime&&t.row.createTime.length>10?t.row.createTime.substring(0,16):t.row.createTime)+" ")]}}],null,!1,1052956272)}),a("el-table-column",{attrs:{prop:"updateType",label:"审核结果",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.auditStatus)+" ")]}}],null,!1,3774294532)}),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"defaultTextBtn",attrs:{type:"text"},on:{click:function(a){return e.findInfo(t.row)}}},[a("svg-icon",{attrs:{"icon-class":"search"}}),e._v(" 查看 ")],1)]}}],null,!1,94581656)})],1)],1)]):e._e(),a("div",{staticClass:"bottom"},["find"!==e.type?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v("保存")]):e._e()],1)],1)},n=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"title"},[a("span",{staticClass:"ganggang"},[e._v("-")]),e._v(" 基本信息")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"title"},[a("span",{staticClass:"ganggang"},[e._v("-")]),e._v(" 工艺卡模板")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"title"},[a("span",{staticClass:"ganggang"},[e._v("-")]),e._v(" 变更操作")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"title"},[a("span",{staticClass:"ganggang"},[e._v("-")]),e._v(" 变更记录")])}],o=a("644f"),r=a("c0e9"),i=a.n(r),l=a("143e"),c=a("c547"),d=a("8de1"),u=a("69aa"),p=a("ff9a"),m=a("b3d9"),f=a("8c4a"),g=a("d1fc"),h={name:"NewCard",components:{rj1:l["a"],rj2:c["a"],yb:d["a"],gjj:u["a"],ht:p["a"],jjft:m["a"],klsmf:f["a"],dmg:g["a"]},props:{objstr:{type:Object,default:null}},data:function(){return{loading:!1,isChecked:!1,currentId:0,machineNameList:[],craftIdList:[],type:"",forms:{productName:""},upforms:{upType:"",upReason:"",dis:""},rules:{productName:[{required:!0,message:"请选择工艺卡",trigger:"blur"}],upType:[{required:!0,message:"请选择变更类型",trigger:"blur"}],upReason:[{required:!0,message:"请输入变更原因",trigger:"blur"}],dis:[{required:!0,message:"请输入变更描述",trigger:"blur"}]},upList:[{id:0,name:"临时变更"},{id:1,name:"永久变更"}],listCard:[],logsList:[],repairObj:null}},computed:{},watch:{},created:function(){},mounted:function(){var e=this;this.findListCards(),this.type=this.objstr.type,"add"!==this.type&&(this.loading=!0,Object(o["c"])({id:this.objstr.id}).then((function(t){e.loading=!1,e.forms.productName=t.data.cardId,sessionStorage.setItem("cardFromJson",t.data.craftData),"find"===e.type&&e.findCardLogs()})))},beforeDestroy:function(){},methods:{changeCraft:function(){sessionStorage.removeItem("cardFromJson")},tableRowClassName:function(e){e.row;var t=e.rowIndex;return t%2===1?"table-row":""},findListCards:function(){var e=this;Object(o["i"])().then((function(t){e.listCard=t.data}))},findCardLogs:function(){var e=this;this.loading=!0,Object(o["e"])({paramsId:this.objstr.id}).then((function(t){e.logsList=t.data,e.loading=!1}))},findInfo:function(e){var t=this;this.loading=!0,this.forms.productName=0,Object(o["f"])({id:e.id}).then((function(e){console.log(e.data.craftAfterData),sessionStorage.setItem("cardFromJson",e.data.craftAfterData),t.forms.productName=e.data.cardId,t.loading=!1}))},submitForm:function(){var e=this,t="add"===this.type?"forms":"upforms";this.$refs[t].validate((function(t){t&&(e.isChecked=!0,e.loading=!0,setTimeout((function(){var t=sessionStorage.getItem("cardFromJson");if(console.log(t),e.isChecked=!1,!t)return e.$message({type:"error",message:"请输入设备编号！"}),void(e.loading=!1);var a=JSON.parse(t);if(!a.partCode)return e.$message({type:"error",message:"请输入零件编号！"}),void(e.loading=!1);if(!a.checked)return e.$message({type:"error",message:"输入参数不合法！"}),void(e.loading=!1);if(!a.partName)return e.$message({type:"error",message:"请输入零件名称！"}),void(e.loading=!1);if(!a.productId)return e.$message({type:"error",message:"请选择设备编号！"}),void(e.loading=!1);var s=document.getElementById("pdfreport"),n=e;i()(s,{imageTimeout:0,scale:1,dpi:96}).then((function(e){var s=e.toDataURL("image/jpeg",.5);if("add"===n.type){var r={cardId:n.forms.productName,partCode:a.partCode,partName:a.partName,productId:a.productId,craftData:t,mouldId:a.mouldNumber,picture:s,documentNo:a.documentNo};Object(o["l"])(r).then((function(e){n.loading=!1,0===e.code?(n.$message({message:"操作成功!",type:"success"}),n.backClick("1")):1e3===e.code&&n.$message({message:e.msg,type:"error"})}))}else{var i={content:n.upforms.dis,paramsId:n.objstr.id,reason:n.upforms.upReason,craftAfterData:t,updateType:n.upforms.upType};Object(o["m"])(i).then((function(e){n.loading=!1,0===e.code?(n.$message({message:"操作成功!",type:"success"}),n.backClick("1")):1e3===e.code&&n.$message({message:e.msg,type:"error"})}))}}))}),1e3))}))},backClick:function(e){this.$emit("DetailCallBack",{result:e})}}},b=h,y=(a("0a16"),a("2877")),v=Object(y["a"])(b,s,n,!1,null,"05e41eff",null);t["a"]=v.exports},a15b:function(e,t,a){"use strict";var s=a("23e7"),n=a("44ad"),o=a("fc6a"),r=a("a640"),i=[].join,l=n!=Object,c=r("join",",");s({target:"Array",proto:!0,forced:l||!c},{join:function(e){return i.call(o(this),void 0===e?",":e)}})},a372:function(e,t,a){}}]);